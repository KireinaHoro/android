--- wxpython-2.8.11.0.ebuild.old	2012-05-07 02:31:12.000000000 +0900
+++ wxpython-2.8.11.0.ebuild	2012-06-08 21:10:18.396556742 +0900
@@ -1,6 +1,6 @@
-# Copyright 1999-2012 Gentoo Foundation
+# Copyright 1999-2010 Gentoo Foundation
 # Distributed under the terms of the GNU General Public License v2
-# $Header: /var/cvsroot/gentoo-x86/dev-python/wxpython/wxpython-2.8.11.0.ebuild,v 1.16 2012/05/06 17:14:35 jlec Exp $
+# $Header: /var/cvsroot/gentoo-x86/dev-python/wxpython/wxpython-2.8.11.0.ebuild,v 1.3 2010/12/12 07:30:02 dirtyepic Exp $
 
 EAPI="2"
 PYTHON_DEPEND="2"
@@ -20,25 +20,27 @@ SRC_URI="mirror://sourceforge/wxpython/$
 
 LICENSE="wxWinLL-3"
 SLOT="2.8"
-KEYWORDS="alpha amd64 arm hppa ia64 ppc ppc64 sh sparc x86 ~x86-fbsd"
-IUSE="cairo doc examples opengl"
+KEYWORDS="~x86-freebsd ~x86-interix ~amd64-linux ~ia64-linux ~x86-linux ~ppc-macos ~x64-macos ~x86-macos"
+IUSE="aqua cairo doc examples opengl"
 
 RDEPEND="
 	dev-python/setuptools
-	>=x11-libs/wxGTK-${PV}:2.8[opengl?,tiff,X]
-	>=x11-libs/gtk+-2.4:2
+	aqua? ( >=x11-libs/wxGTK-${PV}:2.8[opengl?,tiff,aqua=] )
+	!aqua? ( >=x11-libs/wxGTK-${PV}:2.8[opengl?,tiff,X] )
+	>=x11-libs/gtk+-2.4[aqua=]
 	>=x11-libs/pango-1.2
-	dev-libs/glib:2
+	>=dev-libs/glib-2.0
 	media-libs/libpng
 	virtual/jpeg
 	media-libs/tiff
 	cairo?	( >=dev-python/pycairo-1.8.4 )
-	opengl?	( >=dev-python/pyopengl-2.0.0.44 )"
+	opengl?	( >=dev-python/pyopengl-2.0.0.44 )
+	aqua? ( >=dev-lang/python-2.6[aqua?] )"
 
 DEPEND="${RDEPEND}
-	virtual/pkgconfig"
+	dev-util/pkgconfig"
 
-RESTRICT_PYTHON_ABIS="3.* *-jython 2.7-pypy-*"
+RESTRICT_PYTHON_ABIS="3.*"
 
 S="${WORKDIR}/${MY_P}/wxPython"
 DOC_S="${WORKDIR}/wxPython-${PV}"
@@ -61,9 +63,6 @@ src_prepare() {
 	fi
 
 	python_copy_sources
-
-	# Workaround, buildsystem uses CFLAGS as CXXFLAGS
-	export CFLAGS="${CXXFLAGS}"
 }
 
 src_configure() {
@@ -76,7 +75,11 @@ src_configure() {
 		|| mypyconf="${mypyconf} BUILD_GLCANVAS=0"
 
 	mypyconf="${mypyconf} WX_CONFIG=${WX_CONFIG}"
-	mypyconf="${mypyconf} WXPORT=gtk2 UNICODE=1"
+	mypyconf="${mypyconf} UNICODE=1"
+
+	use aqua \
+		&& mypyconf="${mypyconf} WXPORT=mac" \
+		|| mypyconf="${mypyconf} WXPORT=gtk2"
 }
 
 src_compile() {
@@ -94,19 +97,23 @@ src_install() {
 		&& mypyconf="${mypyconf} BUILD_GLCANVAS=1" \
 		|| mypyconf="${mypyconf} BUILD_GLCANVAS=0"
 
-	mypyconf="${mypyconf} WXPORT=gtk2 UNICODE=1"
+	mypyconf="${mypyconf} UNICODE=1"
+
+	use aqua \
+		&& mypyconf="${mypyconf} WXPORT=mac" \
+		|| mypyconf="${mypyconf} WXPORT=gtk2"
 
 	installation() {
-		"$(PYTHON)" setup.py ${mypyconf} install --root="${D}" --install-purelib $(python_get_sitedir)
+		"$(PYTHON)" setup.py ${mypyconf} install --root="${D}" --install-purelib "${EPREFIX}"$(python_get_sitedir)
 	}
 	python_execute_function -s installation
 
 	# Collision protection.
-	for file in "${D}"/usr/bin/*; do
+	for file in "${ED}"/usr/bin/*; do
 		mv "${file}" "${file}-${SLOT}"
 	done
 	rename_files() {
-		for file in "${D}$(python_get_sitedir)/"wx{version.*,.pth}; do
+		for file in "${ED}$(python_get_sitedir)/"wx{version.*,.pth}; do
 			mv "${file}" "${file}-${SLOT}" || return 1
 		done
 	}
@@ -122,17 +129,16 @@ src_install() {
 
 	if use doc; then
 		dodir /usr/share/doc/${PF}/docs
-		cp -R "${DOC_S}"/docs/* "${D}"usr/share/doc/${PF}/docs/
+		cp -R "${DOC_S}"/docs/* "${ED}"usr/share/doc/${PF}/docs/
 		# For some reason newer API docs aren't available so use 2.8.9.2's
-		cp -R "${WORKDIR}"/wxPython-2.8.9.2/docs/* "${D}"usr/share/doc/${PF}/docs/
+		cp -R "${WORKDIR}"/wxPython-2.8.9.2/docs/* "${ED}"usr/share/doc/${PF}/docs/
 	fi
 
 	if use examples; then
 		dodir /usr/share/doc/${PF}/demo
 		dodir /usr/share/doc/${PF}/samples
-		cp -R "${DOC_S}"/demo/* "${D}"/usr/share/doc/${PF}/demo/
-		cp -R "${DOC_S}"/samples/* "${D}"/usr/share/doc/${PF}/samples/
-		rm -f "${D}"usr/share/doc/${PF}/samples/embedded/embedded
+		cp -R "${DOC_S}"/demo/* "${ED}"/usr/share/doc/${PF}/demo/
+		cp -R "${DOC_S}"/samples/* "${ED}"/usr/share/doc/${PF}/samples/
 	fi
 }
 
